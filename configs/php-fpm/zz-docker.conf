[global]
; Emergency restart threshold (restart if this many workers die).
emergency_restart_threshold = 10

; Emergency restart interval (check every 1 minute).
emergency_restart_interval = 1m

; Process control timeout (how long to wait for workers to finish).
process_control_timeout = 10s

[www]

user = www-data
group = www-data

listen = /run/php/php-fpm.sock
listen.owner = www-data
listen.group = www-data
listen.mode = 0660

; Dynamic process manager.
pm = dynamic

; Maximum number of child processes (increased for better handling of concurrent requests).
pm.max_children = 100

; Number of child processes created on startup (increased for faster response).
pm.start_servers = 20

; Minimum number of spare idle processes (increased to handle traffic spikes).
pm.min_spare_servers = 10

; Maximum number of spare idle processes (increased to handle traffic spikes).
pm.max_spare_servers = 30

; Maximum number of requests each child process should execute (prevents memory leaks).
pm.max_requests = 1000

; Process idle timeout (restart idle workers after 10s to free memory).
pm.process_idle_timeout = 10s

; Request timeout (reduced to fail faster and free up workers).
request_terminate_timeout = 180

; Catch worker output.
catch_workers_output = yes

; Clear environment (needed for Docker env vars)
clear_env = no

